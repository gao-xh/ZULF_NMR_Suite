# 权重控件添加滑块功能

## 改进内容
为每个系统的权重控件添加了滑块（Slider），提供更直观的权重调节方式。

## 新的UI布局

每个系统的权重控件现在包含三个部分：

```
[系统名称标签] [=========滑块=========] [数值输入框]
System 1:      [----●----------------]  [1.00    ]
System 2:      [--------●------------]  [0.50    ]
System 3:      [------------●--------]  [0.75    ]
```

## 技术实现

### 1. 滑块配置
- **范围**: 0-1000（对应权重值 0.0-10.0）
- **精度**: 0.01（滑块每步对应 0.01 权重值）
- **刻度**: 每 100 步（对应权重值 1.0）显示一个刻度
- **位置**: 刻度显示在滑块下方

### 2. SpinBox 配置
- **范围**: 0.0-10.0
- **步长**: 0.1
- **小数位**: 2位
- **宽度**: 固定 80-90 像素

### 3. 双向同步
滑块和数值输入框实时双向同步：
- 拖动滑块 → 自动更新数值框
- 修改数值框 → 自动更新滑块位置

### 4. 数据结构
```python
self.weight_spinboxes = {
    "System 1": (slider1, spinbox1),
    "System 2": (slider2, spinbox2),
    ...
}
```

## 修改的方法

### 1. `_update_weight_controls()`
- 为每个系统创建滑块 + 数值框组合
- 设置滑块和数值框的双向绑定
- 更新布局为：标签 + 滑块（占3份空间）+ 数值框（占0份空间，固定宽度）

### 2. 新增 `_on_weight_slider_changed(int_val, spinbox, sys_name)`
- 处理滑块值变化
- 将滑块整数值（0-1000）转换为浮点权重（0.0-10.0）
- 更新对应的数值框（阻止信号避免循环）
- 触发权重变化处理

### 3. 新增 `_on_weight_spinbox_changed(float_val, slider, sys_name)`
- 处理数值框变化
- 将浮点权重（0.0-10.0）转换为滑块整数值（0-1000）
- 更新对应的滑块（阻止信号避免循环）
- 触发权重变化处理

### 4. 更新 `_normalize_weights()`
- 更新归一化逻辑以处理元组结构
- 同时更新滑块和数值框的值
- 使用 `blockSignals()` 避免触发多次更新

## 用户体验改进

### 优点
1. **更直观**: 滑块提供可视化的权重比例
2. **更快速**: 拖动滑块比输入数字更快
3. **更精确**: 数值框仍然保留，可以输入精确值
4. **实时反馈**: 拖动滑块时立即看到加权和的变化

### 使用场景
- **粗调**: 拖动滑块快速调整权重比例
- **精调**: 使用数值框输入精确的权重值
- **比较**: 通过滑块位置直观比较各系统权重

## 代码位置
- **文件**: Multi_system_spinach_UI.py
- **主要方法**: 
  - `_update_weight_controls()` (第1983-2034行)
  - `_on_weight_slider_changed()` (第2036-2041行)
  - `_on_weight_spinbox_changed()` (第2043-2048行)
  - `_normalize_weights()` (第2070-2088行)

## 兼容性
- ✅ 与自动归一化功能完全兼容
- ✅ 与加权和实时更新功能完全兼容
- ✅ 添加/删除系统时自动创建/销毁对应控件
- ✅ 保存/加载参数时正确恢复权重值（需要后续实现保存/加载更新）

## 测试建议
1. 启动程序，检查初始滑块和数值框是否同步
2. 拖动滑块，验证数值框实时更新
3. 修改数值框，验证滑块位置实时更新
4. 添加新系统，验证新的滑块正确创建
5. 删除系统，验证对应滑块正确移除
6. 启用自动归一化，验证所有滑块和数值框同步更新
7. 拖动滑块观察加权和图谱的实时变化
