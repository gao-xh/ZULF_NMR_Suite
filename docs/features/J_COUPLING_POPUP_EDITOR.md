# J-Coupling Popup Editor Feature

## 概述
在上三角Grid输入模式下，现在有一个"Open Large Editor"按钮，可以打开一个更大的弹出窗口，方便输入J-coupling值。

## 使用方法

### 1. 准备工作
1. 在系统标签页中输入同位素（Isotopes）
2. 在J-Coupling Matrix区域，选择输入模式为 "Upper Triangle Grid"

### 2. 生成Grid
1. 点击 "Generate Grid from Isotopes" 按钮
2. 系统会根据同位素数量生成上三角输入网格
3. "Open Large Editor" 按钮会自动启用

### 3. 打开弹出编辑器
1. 点击 "Open Large Editor" 按钮
2. 弹出一个大窗口（800x600），显示完整的J-coupling上三角矩阵
3. 窗口特点：
   - 更大的输入框（80px宽，35px高）
   - 更清晰的同位素标签
   - 更好的视觉布局
   - 支持滚动（适用于多自旋系统）

### 4. 编辑J-coupling值
1. 在弹出窗口中输入或修改J-coupling值
2. 每个输入框显示：
   - 当前值
   - 工具提示：显示对应的自旋对（如 "J(1,2): 1H - 13C"）
3. 输入框有视觉反馈：
   - 正常状态：蓝灰色边框
   - 聚焦时：蓝色边框 + 浅灰背景

### 5. 应用更改
1. 点击 "Apply" 按钮：
   - 将弹出窗口中的所有值同步到主界面的grid
   - 自动同步到Matrix Text模式
   - 关闭弹出窗口
2. 点击 "Cancel" 按钮：
   - 放弃所有更改
   - 关闭弹出窗口

## 界面布局

```
┌─────────────────────────────────────────────────────┐
│  J-Coupling Editor - System A                       │
├─────────────────────────────────────────────────────┤
│  Editing upper triangle for N spins: 1H, 13C, ...   │
├─────────────────────────────────────────────────────┤
│  ┌───────┬─────────┬─────────┬─────────┬─────────┐  │
│  │       │  1H(1)  │ 13C(2)  │  1H(3)  │ 13C(4)  │  │
│  ├───────┼─────────┼─────────┼─────────┼─────────┤  │
│  │ 1H(1) │    —    │  [7.0]  │  [2.5]  │  [0.0]  │  │
│  ├───────┼─────────┼─────────┼─────────┼─────────┤  │
│  │13C(2) │         │    —    │ [10.5]  │  [3.2]  │  │
│  ├───────┼─────────┼─────────┼─────────┼─────────┤  │
│  │ 1H(3) │         │         │    —    │  [7.0]  │  │
│  ├───────┼─────────┼─────────┼─────────┼─────────┤  │
│  │13C(4) │         │         │         │    —    │  │
│  └───────┴─────────┴─────────┴─────────┴─────────┘  │
├─────────────────────────────────────────────────────┤
│                              [Apply]  [Cancel]       │
└─────────────────────────────────────────────────────┘
```

## 优势

### 对比内嵌Grid编辑器
- **空间更大**：800x600窗口 vs 150-350px高度限制
- **输入框更大**：80x35px vs 60x默认高度
- **独立窗口**：可以移动、调整大小，不影响主界面
- **专注编辑**：专门用于J-coupling输入，减少干扰

### 对比文本模式
- **可视化**：清晰看到自旋对应关系
- **防错**：只能输入上三角，避免对称性错误
- **工具提示**：鼠标悬停显示详细信息
- **实时同步**：自动更新到文本模式

## 技术细节

### 数据同步流程
```
弹出编辑器输入
    ↓
[Apply] 按钮点击
    ↓
更新主界面Grid输入框
    ↓
sync_grid_to_text()
    ↓
更新Matrix Text模式
    ↓
parse_system() 时使用
```

### 状态管理
- 按钮初始状态：禁用（disabled）
- Grid生成后：启用（enabled）
- 弹出窗口独立管理自己的输入框
- Apply时：批量同步到主Grid

### 样式特性
- 响应式设计：支持滚动，适应不同自旋数量
- 颜色编码：
  - 蓝色 (#1976D2)：标签、聚焦边框
  - 绿色 (#4CAF50)：Apply按钮
  - 灰色 (#757575)：Cancel按钮
  - 浅蓝背景 (#E3F2FD)：标题行/列
- 大字体：11pt（主界面9-10pt）

## 适用场景

### 最适合：
- **大型系统**：5个或更多自旋
- **精确输入**：需要仔细核对每个耦合值
- **批量编辑**：一次性修改多个值
- **教学演示**：展示J-coupling矩阵结构

### 可选使用：
- **小型系统**：2-4个自旋（内嵌grid已足够）
- **快速测试**：Matrix Text模式可能更快
- **已有数据**：直接粘贴完整矩阵到Text模式

## 注意事项

1. **必须先生成Grid**：
   - 如果没有点击"Generate Grid from Isotopes"，按钮会提示错误
   
2. **数据验证**：
   - Apply时不做额外验证，接受任何文本输入
   - 实际验证在parse_system()时进行

3. **窗口模态**：
   - 弹出窗口是模态对话框（QDialog）
   - 必须关闭后才能操作主窗口

4. **同步机制**：
   - 只在点击Apply时同步
   - Cancel不会保存任何更改
   - 关闭窗口等同于Cancel

## 快捷操作

- **Tab键**：在输入框间导航
- **Enter键**：移到下一个输入框
- **Esc键**：等同于点击Cancel
- **鼠标滚轮**：滚动查看更多自旋

## 未来增强可能性

- [ ] 添加快捷键支持（Ctrl+Enter = Apply）
- [ ] 批量设置功能（设置所有值为X）
- [ ] 预设模板（常见耦合模式）
- [ ] 导入/导出CSV
- [ ] 实时预览（不需要Apply即可看到效果）
- [ ] 撤销/重做功能
- [ ] 值的范围验证和警告
